<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simply Redux</title>
  </head>
  <body>
    <section>
      <h2>Todos</h2>
      <form id="add-todo">
        <input name="todo" required />
        <button type="submit">Add To-Do</button>
      </form>
      <ul id="todos"></ul>
    </section>

    <section>
      <h2>Books</h2>
      <form id="add-book">
        <input name="book" required />
        <button type="submit">Add Book</button>
      </form>
      <ul id="books"></ul>
    </section>
    <script>
      function todoReducer(todos, action) {
        if (action.type === "ADD_TODO") {
          return [...todos, action.todo];
        } else if (action.type === "DELETE_TODO") {
          return todos.filter((todo) => todo.id !== action.id);
        } else if (action.type === "TOGGLE_TODO") {
          const index = todos.findIndex((todo) => todo.id === action.id);

          if (index !== -1) {
            const todo = todos[index];
            const newState = [...todos];
            newState[index] = {
              ...todo,
              completed: !todo.completed,
            };
            return newState;
          }
        }

        return todos;
      }

      function createStore() {
        let state = {
          todos: [],
          books: [],
        };

        const getState = () => state;

        const dispatch = (action) => {
          state.todos = todoReducer(state.todos, action);
        };

        return {
          dispatch,
          getState,
        };
      }

      const store = createStore();

      // UI section
      function renderTodos(todos) {
        const ul = document.getElementById("todos");

        ul.innerHTML = ""; // Remove previous state items

        // Add new state items
        todos.forEach((todo) => {
          const li = document.createElement("li");

          const removeButton = document.createElement("button");
          removeButton.innerText = "Remove";
          removeButton.addEventListener("click", () => {
            const action = {
              type: "DELETE_TODO",
              id: todo.id,
            };

            store.dispatch(action);
            console.log(store.getState());
          });

          li.appendChild(document.createTextNode(todo.text));
          li.appendChild(removeButton);

          ul.appendChild(li);
        });
      }

      window.addEventListener("load", () => {
        const todoForm = document.getElementById("add-todo");

        todoForm.addEventListener("submit", (event) => {
          event.preventDefault();
          const todoInput = todoForm.elements.todo;
          const text = todoInput.value;
          const todo = {
            id: Date.now(),
            text,
            completed: false,
          };

          const action = {
            type: "ADD_TODO",
            todo,
          };
          store.dispatch(action);
          console.log(store.getState().todos);
          renderTodos(store.getState().todos);
        });
      });
    </script>
  </body>
</html>
